-- Roblox æ•´åˆè…³æœ¬ï¼šShiftLock + é€Ÿåº¦/è·³èº/ç„¡é™è·³/é‡åŠ›æ§åˆ¶å™¨
-- è‡ªå‹•æ›è¼‰è‡³ CoreGui ä»¥ä¿æŒåœ¨æœ€ä¸Šå±¤
-- ä¿®æ”¹ç‰ˆï¼šç•Œé¢ç¸®å° 80%

-- 1. é˜²æ­¢é‡è¤‡åŸ·è¡Œæ¸…ç†èˆŠä»‹é¢
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local Workspace = game:GetService("Workspace")

if CoreGui:FindFirstChild("ShiftLockUI") then CoreGui.ShiftLockUI:Destroy() end
if CoreGui:FindFirstChild("SpeedJumpController") then CoreGui.SpeedJumpController:Destroy() end
if playerGui:FindFirstChild("ShiftLockUI") then playerGui.ShiftLockUI:Destroy() end
if playerGui:FindFirstChild("SpeedJumpController") then playerGui.SpeedJumpController:Destroy() end

-------------------------------------------------------------------------
-- æ¨¡çµ„ A: ShiftLock è…³æœ¬ (å®Œæ•´ä¿®æ­£ç‰ˆ)
-------------------------------------------------------------------------
local function loadShiftLock()
    local ref = cloneref or function(x) return x end
    local S = function(n) return ref(game:GetService(n)) end

    local Plrs, Tw, UIS, RS, Wk, CG =
        S("Players"), S("TweenService"), S("UserInputService"), S("RunService"), S("Workspace"), S("CoreGui")

    local plr = Plrs.LocalPlayer

    local function parentUI(g)
        if gethui then
            g.Name = "\0" .. g.Name
            g.Parent = gethui()
            return g
        elseif CG then
            g.Parent = CG
            return g
        else
            g.Parent = plr:WaitForChild("PlayerGui")
            return g
        end
    end

    local function getParts()
        local c = plr.Character or plr.CharacterAdded:Wait()
        local hum = c:FindFirstChildOfClass("Humanoid") or c:WaitForChild("Humanoid")
        local hrp = c:FindFirstChild("HumanoidRootPart") or c:WaitForChild("HumanoidRootPart")
        return c, hum, hrp
    end

    local function lockMouse(v)
        if UIS.MouseEnabled then
            UIS.MouseBehavior = v and Enum.MouseBehavior.LockCenter or Enum.MouseBehavior.Default
        end
    end

    -- ç‹€æ…‹ç®¡ç†
    local lockMode = "none" -- "none", "shiftlock", "nearest", "click"
    local rotCon = nil
    local oldAR = true
    local targetPlayer = nil
    local mouseClickConn = nil
    local lastClickTime = 0
    local lastClickedPlayer = nil

    local gui = Instance.new("ScreenGui")
    gui.Name = "ShiftLockUI"
    gui.ResetOnSpawn = false
    gui.IgnoreGuiInset = true
    parentUI(gui)

    -- å‰ç½®å®£å‘ŠæŒ‰éˆ•è®Šæ•¸
    local btn, nearBtn, clickBtn, espBtn, strk, icn

    local function updateButtonState(button, active)
        local activeColor = Color3.fromRGB(50, 100, 150)
        local inactiveColor = Color3.fromRGB(40, 40, 45)
        
        Tw:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = active and activeColor or inactiveColor
        }):Play()
        
        local stroke = button:FindFirstChild("BtnStroke")
        if stroke then
            Tw:Create(stroke, TweenInfo.new(0.2), {
                Color = active and Color3.fromRGB(0, 200, 255) or Color3.fromRGB(80, 80, 90),
                Thickness = active and 2 or 1
            }):Play()
        end
    end

    -- å¾¹åº•æ¸…é™¤æ‰€æœ‰æ—‹è½‰é–å®šæ¨¡å¼
    local function clearAllModes()
        if rotCon then rotCon:Disconnect(); rotCon = nil end
        if mouseClickConn then mouseClickConn:Disconnect(); mouseClickConn = nil end
        
        lockMouse(false)
        
        local _, h, _ = getParts()
        if h then h.AutoRotate = true end
        
        -- é‡ç½®æ‰€æœ‰ UI é¡è‰²
        icn.Image = "rbxasset://textures/ui/mouseLock_off.png"
        Tw:Create(strk, TweenInfo.new(0.2), {Color = Color3.fromRGB(0, 140, 255), Thickness = 2}):Play()
        Tw:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(34, 34, 38)}):Play()
        
        updateButtonState(nearBtn, false)
        updateButtonState(clickBtn, false)
        
        lockMode = "none"
        targetPlayer = nil
        lastClickedPlayer = nil
    end

    -- æ ¸å¿ƒï¼šé¢å‘é‚è¼¯
    local function setFaceRotation(type, target)
        if rotCon then rotCon:Disconnect() end
        local _, h, r = getParts()
        h.AutoRotate = false
        
        rotCon = RS.RenderStepped:Connect(function()
            local _, _, myHRP = getParts()
            if not myHRP then return end
            
            local lookAtPos = nil
            
            if type == "nearest" then
                local nearest, minDist = nil, math.huge
                for _, p in ipairs(Plrs:GetPlayers()) do
                    if p ~= plr and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        local pRoot = p.Character.HumanoidRootPart
                        local d = (myHRP.Position - pRoot.Position).Magnitude
                        if d < minDist then minDist = d; nearest = pRoot end
                    end
                end
                if nearest then lookAtPos = nearest.Position end
            elseif type == "click" and target and target.Character then
                local pRoot = target.Character:FindFirstChild("HumanoidRootPart")
                if pRoot then lookAtPos = pRoot.Position end
            elseif type == "shiftlock" then
                local cam = Wk.CurrentCamera
                if cam then
                    local lv = cam.CFrame.LookVector
                    lookAtPos = myHRP.Position + Vector3.new(lv.X, 0, lv.Z)
                end
            end
            
            if lookAtPos then
                local flatDir = (lookAtPos - myHRP.Position) * Vector3.new(1, 0, 1)
                if flatDir.Magnitude > 0.001 then
                    myHRP.CFrame = CFrame.lookAt(myHRP.Position, myHRP.Position + flatDir.Unit, Vector3.yAxis)
                end
            end
        end)
    end

    -- UI å‰µå»º
    btn = Instance.new("ImageButton")
    btn.Name = "LockBtn"; btn.AnchorPoint = Vector2.new(0.5, 0.5); btn.Size = UDim2.fromOffset(64, 64)
    btn.Position = UDim2.new(1, -30, 1, -30); btn.BackgroundColor3 = Color3.fromRGB(34, 34, 38)
    btn.AutoButtonColor = false; btn.Parent = gui
    local cr = Instance.new("UICorner"); cr.CornerRadius = UDim.new(1, 0); cr.Parent = btn
    strk = Instance.new("UIStroke"); strk.Thickness = 2; strk.Color = Color3.fromRGB(0, 140, 255); strk.Parent = btn
    icn = Instance.new("ImageLabel")
    icn.Name = "Icn"; icn.BackgroundTransparency = 1; icn.AnchorPoint = Vector2.new(0.5, 0.5)
    icn.Position = UDim2.fromScale(0.5, 0.5); icn.Size = UDim2.fromScale(0.62, 0.62)
    icn.Image = "rbxasset://textures/ui/mouseLock_off.png"; icn.Parent = btn

    local xBtn = Instance.new("TextButton")
    xBtn.Name = "Close"; xBtn.AnchorPoint = Vector2.new(1, 0); xBtn.Position = UDim2.new(1, 5, 0, -5)
    xBtn.Size = UDim2.fromOffset(18, 18); xBtn.BackgroundColor3 = Color3.fromRGB(230, 60, 60); xBtn.Text = "Ã—"
    xBtn.TextSize = 14; xBtn.TextColor3 = Color3.new(1, 1, 1); xBtn.Parent = btn
    Instance.new("UICorner").Parent = xBtn

    local extBtn = Instance.new("TextButton")
    extBtn.Name = "ExtendBtn"; extBtn.AnchorPoint = Vector2.new(0.5, 1); extBtn.Position = UDim2.new(0.5, 0, 0, -8)
    extBtn.Size = UDim2.fromOffset(56, 22); extBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 50); extBtn.Text = "å»¶ä¼¸"
    extBtn.TextSize = 12; extBtn.TextColor3 = Color3.new(1, 1, 1); extBtn.Parent = btn
    Instance.new("UICorner").Parent = extBtn

    local extFrame = Instance.new("Frame")
    extFrame.Name = "ExtFrame"; extFrame.AnchorPoint = Vector2.new(0.5, 1); extFrame.Position = UDim2.new(0.5, 0, 0, -35)
    extFrame.Size = UDim2.fromOffset(64, 0); extFrame.BackgroundTransparency = 1; extFrame.ClipsDescendants = true; extFrame.Parent = btn

    local function createExtraBtn(name, yPos)
        local b = Instance.new("TextButton")
        b.Name = name; b.Size = UDim2.fromOffset(60, 26); b.Position = UDim2.fromOffset(2, yPos)
        b.BackgroundColor3 = Color3.fromRGB(40, 40, 45); b.Text = name; b.TextSize = 11; b.TextColor3 = Color3.new(1,1,1); b.Parent = extFrame
        local c = Instance.new("UICorner"); c.CornerRadius = UDim.new(0.2,0); c.Parent = b
        local s = Instance.new("UIStroke"); s.Thickness = 1; s.Color = Color3.fromRGB(80, 80, 90); s.Name = "BtnStroke"; s.Parent = b
        return b
    end

    espBtn = createExtraBtn("ESP", 0)
    nearBtn = createExtraBtn("æœ€è¿‘", 30)
    clickBtn = createExtraBtn("é»æ“Š", 60)

    -- å»¶ä¼¸åŠŸèƒ½
    local extended = false
    extBtn.Activated:Connect(function()
        extended = not extended
        extBtn.Text = extended and "æ”¶å›" or "å»¶ä¼¸"
        Tw:Create(extFrame, TweenInfo.new(0.3), {Size = UDim2.fromOffset(64, extended and 90 or 0)}):Play()
    end)

    -- æŒ‰éˆ•é‚è¼¯ 1: ShiftLock
    btn.Activated:Connect(function()
        if lockMode == "shiftlock" then
            clearAllModes()
        else
            clearAllModes()
            lockMode = "shiftlock"
            lockMouse(true)
            setFaceRotation("shiftlock")
            icn.Image = "rbxasset://textures/ui/mouseLock_on.png"
            Tw:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(38, 48, 60)}):Play()
        end
    end)

    -- æŒ‰éˆ•é‚è¼¯ 2: é¢å‘æœ€è¿‘çš„äºº
    nearBtn.Activated:Connect(function()
        if lockMode == "nearest" then
            clearAllModes()
        else
            clearAllModes()
            lockMode = "nearest"
            updateButtonState(nearBtn, true)
            setFaceRotation("nearest")
        end
    end)

    -- æŒ‰éˆ•é‚è¼¯ 3: é¢å‘é»æ“Šçš„äºº (é€£é»2æ¬¡ç›´æ¥é–å®š - æ”¯æ´ç©¿ç‰†é»æ“Š)
    clickBtn.Activated:Connect(function()
        if lockMode == "click" then
            clearAllModes()
        else
            clearAllModes()
            lockMode = "click"
            updateButtonState(clickBtn, true)
            
            -- ä½¿ç”¨æ»‘é¼ é»æ“Šäº‹ä»¶ä¾†åµæ¸¬ï¼ˆæ”¯æ´ç©¿ç‰†ï¼‰
            mouseClickConn = plr:GetMouse().Button1Down:Connect(function()
                local mouse = plr:GetMouse()
                local cam = Wk.CurrentCamera
                
                -- æ–¹æ³•1: ä½¿ç”¨å°„ç·šç©¿é€æ‰€æœ‰ç‰©é«”ä¾†æ‰¾ç©å®¶
                local ray = cam:ScreenPointToRay(mouse.X, mouse.Y)
                local rayOrigin = ray.Origin
                local rayDirection = ray.Direction * 1000 -- å°„ç·šé•·åº¦1000æ ¼
                
                local foundPlayer = nil
                local minDistance = math.huge
                
                -- æª¢æŸ¥æ‰€æœ‰ç©å®¶ï¼Œæ‰¾å‡ºæœ€é è¿‘å°„ç·šçš„ç©å®¶
                for _, p in ipairs(Plrs:GetPlayers()) do
                    if p ~= plr and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        local hrp = p.Character.HumanoidRootPart
                        local playerPos = hrp.Position
                        
                        -- è¨ˆç®—ç©å®¶ä½ç½®åˆ°å°„ç·šçš„è·é›¢
                        local rayToPlayer = playerPos - rayOrigin
                        local projection = rayToPlayer:Dot(rayDirection.Unit)
                        
                        if projection > 0 then -- ç©å®¶åœ¨å°„ç·šå‰æ–¹
                            local closestPoint = rayOrigin + rayDirection.Unit * projection
                            local distance = (playerPos - closestPoint).Magnitude
                            
                            -- å¦‚æœè·é›¢å°æ–¼ç©å®¶ç¢°æ’ç®±åŠå¾‘çš„2å€ï¼Œè¦–ç‚ºé»æ“Šåˆ°
                            if distance < 8 and projection < minDistance then
                                minDistance = projection
                                foundPlayer = p
                            end
                        end
                    end
                end
                
                -- æ–¹æ³•2: å¦‚æœæ²’æ‰¾åˆ°ï¼Œå˜—è©¦ç”¨å‚³çµ±æ–¹æ³•
                if not foundPlayer then
                    local target = mouse.Target
                    if target then
                        -- å¾é»æ“Šçš„éƒ¨ä»¶å¾€ä¸Šæ‰¾ç©å®¶è§’è‰²
                        local char = target:FindFirstAncestorWhichIsA("Model")
                        if char then
                            foundPlayer = Plrs:GetPlayerFromCharacter(char)
                        end
                        
                        -- æª¢æŸ¥æ˜¯å¦é»æ“Šåˆ°ESPçš„BoxHandleAdornment
                        if not foundPlayer then
                            for player, box in pairs(espBoxes) do
                                if box and box.Adornee and target:IsDescendantOf(box.Adornee) then
                                    foundPlayer = player
                                    break
                                end
                            end
                        end
                        
                        -- éæ­·æ‰€æœ‰ç©å®¶æª¢æŸ¥
                        if not foundPlayer then
                            for _, p in ipairs(Plrs:GetPlayers()) do
                                if p ~= plr and p.Character then
                                    if target:IsDescendantOf(p.Character) then
                                        foundPlayer = p
                                        break
                                    end
                                end
                            end
                        end
                    end
                end
                
                if foundPlayer and foundPlayer ~= plr then
                    local now = tick()
                    print("é»æ“Šäº†:", foundPlayer.Name, "ä¸Šæ¬¡é»æ“Š:", lastClickedPlayer and lastClickedPlayer.Name or "ç„¡", "æ™‚é–“å·®:", now - lastClickTime)
                    
                    -- é€£é»æª¢æ¸¬ï¼š0.5ç§’å…§é»æ“ŠåŒä¸€ç©å®¶
                    if lastClickedPlayer == foundPlayer and (now - lastClickTime) < 0.5 then
                        targetPlayer = foundPlayer
                        setFaceRotation("click", foundPlayer)
                        print("âœ“ æˆåŠŸé–å®š:", foundPlayer.Name)
                    end
                    lastClickedPlayer = foundPlayer
                    lastClickTime = now
                end
            end)
        end
    end)

    -- ESP åŠŸèƒ½ (å®Œæ•´ç‰ˆæœ¬ï¼šæ–‡å­— + ç™½è‰²æ¡†)
    local espEnabled = false
    local espLabels = {}
    local espBoxes = {}
    local espConn = nil

    local function createESPBox(character)
        local box = Instance.new("BoxHandleAdornment")
        box.Size = character:GetExtentsSize()
        box.Color3 = Color3.fromRGB(255, 255, 255)
        box.Transparency = 0.7
        box.AlwaysOnTop = true
        box.ZIndex = 1
        box.Adornee = character
        box.Parent = gui
        return box
    end

    espBtn.Activated:Connect(function()
        espEnabled = not espEnabled
        updateButtonState(espBtn, espEnabled)
        
        if not espEnabled then
            if espConn then espConn:Disconnect(); espConn = nil end
            for _, d in pairs(espLabels) do if d.billboard then d.billboard:Destroy() end end
            for _, box in pairs(espBoxes) do if box then box:Destroy() end end
            espLabels = {}
            espBoxes = {}
        else
            espConn = RS.RenderStepped:Connect(function()
                local _, _, myHRP = getParts()
                if not myHRP then return end
                
                for _, p in ipairs(Plrs:GetPlayers()) do
                    if p ~= plr and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        local char = p.Character
                        local hrp = char.HumanoidRootPart
                        local hum = char:FindFirstChildOfClass("Humanoid")
                        
                        -- å‰µå»ºæ–‡å­—æ¨™ç±¤
                        if not espLabels[p] then
                            local bg = Instance.new("BillboardGui")
                            bg.Size = UDim2.fromOffset(200, 50)
                            bg.AlwaysOnTop = true
                            bg.StudsOffset = Vector3.new(0, 3, 0)
                            bg.Adornee = hrp
                            
                            local tl = Instance.new("TextLabel")
                            tl.Size = UDim2.fromScale(1, 1)
                            tl.BackgroundTransparency = 1
                            tl.TextColor3 = Color3.new(1, 1, 1)
                            tl.TextStrokeTransparency = 0.5
                            tl.TextSize = 14
                            tl.Font = Enum.Font.SourceSansBold
                            tl.Parent = bg
                            
                            bg.Parent = gui
                            espLabels[p] = {billboard = bg, label = tl}
                        end
                        
                        -- å‰µå»ºç™½è‰²æ¡†
                        if not espBoxes[p] then
                            espBoxes[p] = createESPBox(char)
                        end
                        
                        -- æ›´æ–°æ–‡å­—å…§å®¹
                        if hum then
                            local dist = (myHRP.Position - hrp.Position).Magnitude
                            local speed = hum.WalkSpeed or 0
                            
                            espLabels[p].label.Text = string.format(
                                "å: %s\nè¡€é‡: %.0f\né€Ÿåº¦: %.1f\nè·é›¢: %.1f",
                                p.Name, hum.Health, speed, dist
                            )
                            
                            -- å›ºå®šæ–‡å­—å¤§å°ï¼Œä¸éš¨è·é›¢æ”¹è®Š
                            espLabels[p].label.TextSize = 14
                        end
                        
                        -- æ›´æ–°æ¡†çš„å¤§å°
                        if espBoxes[p] then
                            espBoxes[p].Size = char:GetExtentsSize()
                        end
                    else
                        -- æ¸…ç†å·²é›¢é–‹çš„ç©å®¶
                        if espLabels[p] and espLabels[p].billboard then
                            espLabels[p].billboard:Destroy()
                            espLabels[p] = nil
                        end
                        if espBoxes[p] then
                            espBoxes[p]:Destroy()
                            espBoxes[p] = nil
                        end
                    end
                end
            end)
        end
    end)

    -- æ‹–æ›³åŠŸèƒ½
    local dragging, dragInput, dragStart, startPos
    btn.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true; dragStart = input.Position; startPos = btn.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            btn.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    -- é—œé–‰èˆ‡é‡ç”Ÿ
    xBtn.Activated:Connect(function() 
        clearAllModes()
        if espEnabled then
            espEnabled = false
            if espConn then espConn:Disconnect() end
            for _, d in pairs(espLabels) do if d.billboard then d.billboard:Destroy() end end
            for _, box in pairs(espBoxes) do if box then box:Destroy() end end
        end
        gui:Destroy()
    end)
    
    plr.CharacterAdded:Connect(function()
        task.wait(0.5)
        if lockMode ~= "none" then setFaceRotation(lockMode, targetPlayer) end
    end)

    print("ShiftLock å®Œæ•´ä¿®æ­£ç‰ˆå·²è¼‰å…¥")
end

task.spawn(function() pcall(loadShiftLock) end)

-------------------------------------------------------------------------
-- æ¨¡çµ„ B: é€Ÿåº¦/è·³èº/ç„¡é™è·³/é‡åŠ›æ§åˆ¶å™¨ (ç¸®å° 80%)
-------------------------------------------------------------------------

local originalSpeed = 16
local originalJump = 50
local originalGravity = 196.2
local hasOriginalValues = false

local function getOriginalValues()
    if speedActive or jumpActive or gravActive or infJumpActive then return end
    
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            originalSpeed = humanoid.WalkSpeed
            if humanoid.UseJumpPower then
                originalJump = humanoid.JumpPower
            else
                originalJump = humanoid.JumpHeight
            end
        end
    end
    originalGravity = Workspace.Gravity
    hasOriginalValues = true
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SpeedJumpController"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
screenGui.DisplayOrder = 10001

local function parentUI(g)
    local success, err = pcall(function()
        if gethui then
            g.Parent = gethui()
        elseif game:GetService("CoreGui") then
            g.Parent = game:GetService("CoreGui")
        else
            g.Parent = playerGui
        end
    end)
    if not success then g.Parent = playerGui end
end
parentUI(screenGui)

-- ä¸»æ¡†æ¶ (ç¸®å°åˆ° 260x250)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 260, 0, 250)
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -125)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = mainFrame

-- æ¨™é¡Œæ¬„ (ç¸®å°åˆ° 32)
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 32)
titleBar.BackgroundColor3 = Color3.fromRGB(102, 126, 234)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame
local titleBarCorner = Instance.new("UICorner"); titleBarCorner.CornerRadius = UDim.new(0, 10); titleBarCorner.Parent = titleBar
local titleBarBottom = Instance.new("Frame"); titleBarBottom.Size = UDim2.new(1, 0, 0, 10); titleBarBottom.Position = UDim2.new(0, 0, 1, -10); titleBarBottom.BackgroundColor3 = Color3.fromRGB(102, 126, 234); titleBarBottom.BorderSizePixel = 0; titleBarBottom.Parent = titleBar

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -60, 1, 0)
title.BackgroundTransparency = 1
title.Text = "ğŸ® è²“ç²çš„å…¨èƒ½æ§åˆ¶å™¨"
title.TextSize = 15
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Parent = titleBar

-- ç¸®å°/é—œé–‰æŒ‰éˆ• (24x24)
local minimizeButton = Instance.new("TextButton")
minimizeButton.Size = UDim2.new(0, 24, 0, 24)
minimizeButton.Position = UDim2.new(1, -54, 0, 4)
minimizeButton.BackgroundColor3 = Color3.fromRGB(158, 158, 158)
minimizeButton.Text = "â”€"; minimizeButton.TextSize = 15; minimizeButton.Font = Enum.Font.GothamBold; minimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255); minimizeButton.Parent = titleBar
local minCorner = Instance.new("UICorner"); minCorner.CornerRadius = UDim.new(0, 5); minCorner.Parent = minimizeButton

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 24, 0, 24)
closeButton.Position = UDim2.new(1, -28, 0, 4)
closeButton.BackgroundColor3 = Color3.fromRGB(244, 67, 54)
closeButton.Text = "X"; closeButton.TextSize = 15; closeButton.Font = Enum.Font.GothamBold; closeButton.TextColor3 = Color3.fromRGB(255, 255, 255); closeButton.Parent = titleBar
local closeCorner = Instance.new("UICorner"); closeCorner.CornerRadius = UDim.new(0, 5); closeCorner.Parent = closeButton

-- é€šç”¨å‡½æ•¸ï¼šå‰µå»ºæ§åˆ¶è¡Œ (æ›´å°ç‰ˆ)
local function createControlRow(parent, yPos, labelText, placeholder, defaultVal, isInput)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.9, 0, 0, 32)
    frame.Position = UDim2.new(0.05, 0, 0, yPos)
    frame.BackgroundColor3 = Color3.fromRGB(248, 249, 250)
    frame.BorderSizePixel = 0
    frame.Parent = parent
    local fCorner = Instance.new("UICorner"); fCorner.CornerRadius = UDim.new(0, 6); fCorner.Parent = frame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 45, 1, 0)
    label.Position = UDim2.new(0, 6, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = labelText
    label.TextSize = 13
    label.Font = Enum.Font.GothamBold
    label.TextColor3 = Color3.fromRGB(85, 85, 85)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local input
    if isInput then
        input = Instance.new("TextBox")
        input.Size = UDim2.new(0, 70, 0, 22)
        input.Position = UDim2.new(0, 54, 0, 5)
        input.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        input.BorderColor3 = Color3.fromRGB(221, 221, 221)
        input.BorderSizePixel = 1
        input.Text = defaultVal
        input.TextSize = 13
        input.Font = Enum.Font.Gotham
        input.TextColor3 = Color3.fromRGB(50, 50, 50)
        input.PlaceholderText = placeholder
        input.Parent = frame
        local iCorner = Instance.new("UICorner"); iCorner.CornerRadius = UDim.new(0, 5); iCorner.Parent = input
    else
        input = Instance.new("TextLabel")
        input.Size = UDim2.new(0, 70, 0, 22)
        input.Position = UDim2.new(0, 54, 0, 5)
        input.BackgroundTransparency = 1
        input.Text = "é—œé–‰"
        input.TextSize = 13
        input.Font = Enum.Font.Gotham
        input.TextColor3 = Color3.fromRGB(150, 150, 150)
        input.TextXAlignment = Enum.TextXAlignment.Center
        input.Parent = frame
    end

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 56, 0, 22)
    btn.Position = UDim2.new(1, -60, 0, 5)
    btn.BackgroundColor3 = Color3.fromRGB(76, 175, 80)
    btn.BorderSizePixel = 0
    btn.Text = "å•Ÿå‹•"
    btn.TextSize = 13
    btn.Font = Enum.Font.GothamBold
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Parent = frame
    local bCorner = Instance.new("UICorner"); bCorner.CornerRadius = UDim.new(0, 5); bCorner.Parent = btn

    return frame, input, btn
end

-- 1. é€Ÿåº¦æ§åˆ¶ (Y=44)
local speedFrame, speedInput, speedButton = createControlRow(mainFrame, 44, "é€Ÿåº¦:", "è¼¸å…¥é€Ÿåº¦", "70", true)

-- 2. è·³èºæ§åˆ¶ (Y=84)
local jumpFrame, jumpInput, jumpButton = createControlRow(mainFrame, 84, "è·³èº:", "è¼¸å…¥è·³èº", "75", true)

-- 3. ç„¡é™è·³æ§åˆ¶ (Y=124)
local infJumpFrame, infJumpStatus, infJumpButton = createControlRow(mainFrame, 124, "ç„¡é™è·³:", "", "", false)

-- 4. é‡åŠ›æ§åˆ¶ (Y=164)
local gravFrame, gravInput, gravButton = createControlRow(mainFrame, 164, "é‡åŠ›:", "è¼¸å…¥é‡åŠ›", "50", true)

-- ç‹€æ…‹é¡¯ç¤º (åº•éƒ¨ï¼Œç¸®å°åˆ° 26)
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0.9, 0, 0, 26)
statusLabel.Position = UDim2.new(0.05, 0, 1, -32)
statusLabel.BackgroundColor3 = Color3.fromRGB(255, 235, 238)
statusLabel.BorderSizePixel = 0
statusLabel.Text = "ç³»çµ±æœªå•Ÿå‹•"
statusLabel.TextSize = 11
statusLabel.Font = Enum.Font.GothamBold
statusLabel.TextColor3 = Color3.fromRGB(198, 40, 40)
statusLabel.Parent = mainFrame
local statCorner = Instance.new("UICorner"); statCorner.CornerRadius = UDim.new(0, 5); statCorner.Parent = statusLabel

-- ç¸®å°å¾Œçš„å°è¦–çª— (130x32)
local miniFrame = Instance.new("Frame")
miniFrame.Size = UDim2.new(0, 130, 0, 32)
miniFrame.Position = UDim2.new(0.5, -65, 0, 30)
miniFrame.BackgroundColor3 = Color3.fromRGB(102, 126, 234)
miniFrame.Visible = false
miniFrame.Parent = screenGui
local mCorner = Instance.new("UICorner"); mCorner.CornerRadius = UDim.new(0, 6); mCorner.Parent = miniFrame
local miniTitle = Instance.new("TextLabel"); miniTitle.Size = UDim2.new(1, -36, 1, 0); miniTitle.BackgroundTransparency = 1; miniTitle.Text = "ğŸ® æ§åˆ¶å™¨"; miniTitle.TextSize = 13; miniTitle.Font = Enum.Font.GothamBold; miniTitle.TextColor3 = Color3.fromRGB(255, 255, 255); miniTitle.Parent = miniFrame
local expandButton = Instance.new("TextButton"); expandButton.Size = UDim2.new(0, 24, 0, 24); expandButton.Position = UDim2.new(1, -28, 0, 4); expandButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80); expandButton.Text = "+"; expandButton.TextSize = 18; expandButton.Font = Enum.Font.GothamBold; expandButton.TextColor3 = Color3.fromRGB(255, 255, 255); expandButton.Parent = miniFrame; local eCorner = Instance.new("UICorner"); eCorner.CornerRadius = UDim.new(0, 5); eCorner.Parent = expandButton

-- é‚è¼¯è®Šæ•¸
local speedActive = false
local jumpActive = false
local gravActive = false
local infJumpActive = false

local speedValue = 70
local jumpValue = 75
local gravValue = 50

local speedConnection = nil
local jumpConnection = nil
local gravConnection = nil
local infJumpConnection = nil

task.spawn(function()
    if player.Character then
        task.wait(0.1)
        getOriginalValues()
    end
end)

local function updateStatus()
    local parts = {}
    if speedActive then table.insert(parts, "é€Ÿåº¦") end
    if jumpActive then table.insert(parts, "è·³èº") end
    if infJumpActive then table.insert(parts, "ç„¡é™è·³") end
    if gravActive then table.insert(parts, "é‡åŠ›") end
    
    if #parts > 0 then
        statusLabel.Text = "âœ… " .. table.concat(parts, " | ") .. " å·²å•Ÿå‹•"
        statusLabel.BackgroundColor3 = Color3.fromRGB(232, 245, 233)
        statusLabel.TextColor3 = Color3.fromRGB(46, 125, 50)
    else
        statusLabel.Text = "ç³»çµ±æœªå•Ÿå‹•"
        statusLabel.BackgroundColor3 = Color3.fromRGB(255, 235, 238)
        statusLabel.TextColor3 = Color3.fromRGB(198, 40, 40)
    end
end

-- === é€Ÿåº¦æ§åˆ¶ ===
speedButton.MouseButton1Click:Connect(function()
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end
    
    if not speedActive then
        if not hasOriginalValues then getOriginalValues() end
        speedValue = tonumber(speedInput.Text) or 70
        speedActive = true
        speedButton.Text = "è§£é™¤"
        speedButton.BackgroundColor3 = Color3.fromRGB(244, 67, 54)
        speedInput.TextEditable = false
        speedFrame.BackgroundColor3 = Color3.fromRGB(227, 242, 253)
        
        hum.WalkSpeed = speedValue
        if speedConnection then speedConnection:Disconnect() end
        speedConnection = hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
            if speedActive then hum.WalkSpeed = speedValue end
        end)
    else
        speedActive = false
        speedButton.Text = "å•Ÿå‹•"
        speedButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80)
        speedInput.TextEditable = true
        speedFrame.BackgroundColor3 = Color3.fromRGB(248, 249, 250)
        hum.WalkSpeed = originalSpeed
        if speedConnection then speedConnection:Disconnect() end
    end
    updateStatus()
end)

-- === è·³èºåŠ›æ§åˆ¶ ===
jumpButton.MouseButton1Click:Connect(function()
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end
    
    if not jumpActive then
        if not hasOriginalValues then getOriginalValues() end
        jumpValue = tonumber(jumpInput.Text) or 75
        jumpActive = true
        jumpButton.Text = "è§£é™¤"
        jumpButton.BackgroundColor3 = Color3.fromRGB(244, 67, 54)
        jumpInput.TextEditable = false
        jumpFrame.BackgroundColor3 = Color3.fromRGB(227, 242, 253)
        
        if hum.UseJumpPower then
            hum.JumpPower = jumpValue
            if jumpConnection then jumpConnection:Disconnect() end
            jumpConnection = hum:GetPropertyChangedSignal("JumpPower"):Connect(function()
                if jumpActive then hum.JumpPower = jumpValue end
            end)
        else
            hum.JumpHeight = jumpValue
            if jumpConnection then jumpConnection:Disconnect() end
            jumpConnection = hum:GetPropertyChangedSignal("JumpHeight"):Connect(function()
                if jumpActive then hum.JumpHeight = jumpValue end
            end)
        end
    else
        jumpActive = false
        jumpButton.Text = "å•Ÿå‹•"
        jumpButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80)
        jumpInput.TextEditable = true
        jumpFrame.BackgroundColor3 = Color3.fromRGB(248, 249, 250)
        
        if hum.UseJumpPower then hum.JumpPower = originalJump else hum.JumpHeight = originalJump end
        if jumpConnection then jumpConnection:Disconnect() end
    end
    updateStatus()
end)

-- === ç„¡é™è·³æ§åˆ¶ ===
local UserInputService = game:GetService("UserInputService")
infJumpConnection = UserInputService.JumpRequest:Connect(function()
    if infJumpActive then
        local char = player.Character
        if char then
            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
end)

infJumpButton.MouseButton1Click:Connect(function()
    if not infJumpActive then
        infJumpActive = true
        infJumpButton.Text = "è§£é™¤"
        infJumpButton.BackgroundColor3 = Color3.fromRGB(244, 67, 54)
        infJumpStatus.Text = "é–‹å•Ÿ"
        infJumpStatus.TextColor3 = Color3.fromRGB(46, 125, 50)
        infJumpFrame.BackgroundColor3 = Color3.fromRGB(227, 242, 253)
    else
        infJumpActive = false
        infJumpButton.Text = "å•Ÿå‹•"
        infJumpButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80)
        infJumpStatus.Text = "é—œé–‰"
        infJumpStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
        infJumpFrame.BackgroundColor3 = Color3.fromRGB(248, 249, 250)
    end
    updateStatus()
end)

-- === é‡åŠ›æ§åˆ¶ ===
gravButton.MouseButton1Click:Connect(function()
    if not gravActive then
        if not hasOriginalValues then getOriginalValues() end
        gravValue = tonumber(gravInput.Text) or 50
        gravActive = true
        gravButton.Text = "è§£é™¤"
        gravButton.BackgroundColor3 = Color3.fromRGB(244, 67, 54)
        gravInput.TextEditable = false
        gravFrame.BackgroundColor3 = Color3.fromRGB(227, 242, 253)
        
        Workspace.Gravity = gravValue
        
        if gravConnection then gravConnection:Disconnect() end
        gravConnection = Workspace:GetPropertyChangedSignal("Gravity"):Connect(function()
            if gravActive and Workspace.Gravity ~= gravValue then
                Workspace.Gravity = gravValue
            end
        end)
    else
        gravActive = false
        gravButton.Text = "å•Ÿå‹•"
        gravButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80)
        gravInput.TextEditable = true
        gravFrame.BackgroundColor3 = Color3.fromRGB(248, 249, 250)
        
        Workspace.Gravity = originalGravity
        if gravConnection then gravConnection:Disconnect() end
    end
    updateStatus()
end)

-- è¦–çª—æ§åˆ¶
minimizeButton.MouseButton1Click:Connect(function() mainFrame.Visible = false; miniFrame.Visible = true end)
expandButton.MouseButton1Click:Connect(function() miniFrame.Visible = false; mainFrame.Visible = true end)
closeButton.MouseButton1Click:Connect(function()
    local char = player.Character
    if char then
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then
            if speedActive then hum.WalkSpeed = originalSpeed end
            if jumpActive then
                if hum.UseJumpPower then hum.JumpPower = originalJump else hum.JumpHeight = originalJump end
            end
        end
    end
    if gravActive then Workspace.Gravity = originalGravity end
    
    if speedConnection then speedConnection:Disconnect() end
    if jumpConnection then jumpConnection:Disconnect() end
    if gravConnection then gravConnection:Disconnect() end
    if infJumpConnection then infJumpConnection:Disconnect() end
    
    screenGui:Destroy()
end)

-- é‡ç”Ÿè™•ç†
player.CharacterAdded:Connect(function(char)
    local hum = char:WaitForChild("Humanoid")
    hasOriginalValues = false
    task.wait(0.2)
    if not (speedActive or jumpActive or gravActive or infJumpActive) then getOriginalValues() end
    
    if speedActive then
        hum.WalkSpeed = speedValue
        if speedConnection then speedConnection:Disconnect() end
        speedConnection = hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
            if speedActive then hum.WalkSpeed = speedValue end
        end)
    end
    
    if jumpActive then
        if hum.UseJumpPower then
            hum.JumpPower = jumpValue
            if jumpConnection then jumpConnection:Disconnect() end
            jumpConnection = hum:GetPropertyChangedSignal("JumpPower"):Connect(function()
                if jumpActive then hum.JumpPower = jumpValue end
            end)
        else
            hum.JumpHeight = jumpValue
            if jumpConnection then jumpConnection:Disconnect() end
            jumpConnection = hum:GetPropertyChangedSignal("JumpHeight"):Connect(function()
                if jumpActive then hum.JumpHeight = jumpValue end
            end)
        end
    end
end)

-- æ‹–æ›³åŠŸèƒ½
local function enableDrag(frame, handle)
    local dragging, dragInput, dragStart, startPos
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

enableDrag(mainFrame, titleBar)
enableDrag(miniFrame, miniFrame)

print("é€Ÿåº¦/è·³èº/ç„¡é™è·³/é‡åŠ›æ§åˆ¶å™¨å·²è¼‰å…¥ (æ¥µå°ç‰ˆ)")
